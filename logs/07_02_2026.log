2026-02-07 17:34:48,706 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 17:34:48,738 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 17:34:49,036 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 17:34:49,037 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 17:34:49,041 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 17:34:49,041 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 17:34:49,041 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 17:34:49,041 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 17:34:49,043 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 17:34:49,043 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 17:34:49,043 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 17:34:49,043 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 17:35:11,979 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Comment le tenure (ancienneté) influence-t-il l...
2026-02-07 17:35:11,979 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 17:35:11,980 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=60
2026-02-07 17:35:11,985 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 17:35:11,985 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 17:35:11,985 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 17:35:17,140 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 257 events processed
2026-02-07 17:35:17,141 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 17:35:17,141 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 17:35:17,141 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 17:35:17,192 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 17:35:17,193 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 17:35:17,194 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 17:35:19,860 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 120 events processed
2026-02-07 17:35:19,860 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 17:35:19,860 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 17:35:19,861 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 17:35:20,038 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 17:35:20,039 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 17:35:20,039 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 17:35:20,040 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 17:35:20,040 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 17:35:21,909 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Streaming parse error after 114 events (ignored): expected value at line 1 column 1
2026-02-07 17:35:21,909 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 114 events processed
2026-02-07 17:35:21,910 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 17:35:21,910 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: You must finish streaming before calling run()
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 118, in _process_request
    async with self._agent.iter(
               ~~~~~~~~~~~~~~~~^
        prompt,
        ^^^^^^^
        deps=context,
        ^^^^^^^^^^^^^
        message_history=message_history,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as run:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/agent/__init__.py", line 707, in iter
    async with graph.iter(
               ~~~~~~~~~~^
        inputs=user_prompt_node,
        ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        infer_name=False,
        ^^^^^^^^^^^^^^^^^
    ) as graph_run:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        graph=self,
        ^^^^^^^^^^^
    ...<3 lines>...
        traceparent=traceparent,
        ^^^^^^^^^^^^^^^^^^^^^^^^
    ) as graph_run:
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 768, in __aexit__
    raise exc
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 454, in run
    raise exceptions.AgentRunError('You must finish streaming before calling run()')  # pragma: no cover
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_ai.exceptions.AgentRunError: You must finish streaming before calling run()
2026-02-07 17:35:21,916 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: You must finish streaming before calling run()
2026-02-07 17:35:21,917 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 17:51:42,108 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 17:51:42,109 - src.application.services.cancellation_manager - INFO - CancellationManager arrêté
2026-02-07 17:51:42,109 - src.application.services.messaging_service - INFO - Arrêt du MessagingService...
2026-02-07 17:51:42,110 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 17:51:42,110 - src.application.services.messaging_service - INFO - MessagingService déconnecté
2026-02-07 17:51:43,819 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 17:51:43,842 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 17:51:44,117 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 17:51:44,118 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 17:51:44,121 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 17:51:44,121 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 17:51:44,121 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 17:51:44,121 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 17:51:44,123 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 17:51:44,123 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 17:51:44,124 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 17:51:44,124 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 17:51:51,673 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Comment le tenure (ancienneté) influence-t-il l...
2026-02-07 17:51:51,674 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 17:51:51,674 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=60
2026-02-07 17:51:51,678 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 17:51:51,678 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 17:51:51,678 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 17:51:54,076 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 64 events processed
2026-02-07 17:51:54,076 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 17:51:54,077 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 17:51:54,077 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 17:51:54,115 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 17:51:54,116 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 17:51:54,116 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 17:51:56,394 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 41 events processed
2026-02-07 17:51:56,394 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 17:51:56,394 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 17:51:56,395 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 17:51:56,459 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 17:51:56,460 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 17:51:56,461 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 17:51:58,459 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 54 events processed
2026-02-07 17:51:58,459 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 17:51:58,459 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 17:51:58,460 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 17:51:58,588 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 17:51:58,589 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 17:51:58,589 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 17:51:58,591 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 17:51:58,591 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 17:52:00,344 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 76 events processed
2026-02-07 17:52:00,344 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=362
2026-02-07 17:52:00,345 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 17:52:00,345 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 17:52:00,345 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 10 nodes
2026-02-07 17:52:00,346 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 result: response_len=362, needs_viz=True
2026-02-07 17:52:00,346 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Evaluating: needs_viz=True, has_visual=True, attempt=0/2
2026-02-07 17:52:00,346 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 17:52:00,346 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 17:52:00,346 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 17:52:00,346 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: '{"response": "Le taux de churn est plus élevé chez les clients avec une tenure de 0-12 mois (environ...'
2026-02-07 17:52:00,348 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 17:52:00,348 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 17:52:00,348 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 17:52:49,023 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Y a-t-il une corrélation entre la taille du mot...
2026-02-07 17:52:49,023 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 17:52:49,023 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=67
2026-02-07 17:52:49,027 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 17:52:49,027 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 17:52:49,027 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 17:52:51,693 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 139 events processed
2026-02-07 17:52:51,693 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 17:52:51,693 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 17:52:51,694 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 17:52:51,729 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 17:52:51,730 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 17:52:51,731 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 17:52:53,373 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 100 events processed
2026-02-07 17:52:53,373 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=458
2026-02-07 17:52:53,374 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 17:52:53,374 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 17:52:53,374 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 6 nodes
2026-02-07 17:52:53,374 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 result: response_len=458, needs_viz=True
2026-02-07 17:52:53,374 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Evaluating: needs_viz=True, has_visual=False, attempt=0/2
2026-02-07 17:52:53,374 - src.application.services.visualization_retry_manager - INFO - [RETRY:chabane.abdelkarim@gmail.com] Triggering retry 1/2 (visualization expected but not produced)
2026-02-07 17:52:53,375 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Preparing retry with prompt: Crée une visualisation (graphique ou tableau) pour...
2026-02-07 17:52:53,375 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #2, history_len=4, prompt_len=83
2026-02-07 17:52:53,376 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 17:52:53,376 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 17:52:53,376 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 17:52:55,453 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 127 events processed
2026-02-07 17:52:55,453 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=255
2026-02-07 17:52:55,453 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 17:52:55,453 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 17:52:55,454 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #2 ended after 4 nodes
2026-02-07 17:52:55,454 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #2 result: response_len=255, needs_viz=True
2026-02-07 17:52:55,454 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Evaluating: needs_viz=True, has_visual=False, attempt=1/2
2026-02-07 17:52:55,454 - src.application.services.visualization_retry_manager - INFO - [RETRY:chabane.abdelkarim@gmail.com] Triggering retry 2/2 (visualization expected but not produced)
2026-02-07 17:52:55,455 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Preparing retry with prompt: Crée une visualisation (graphique ou tableau) pour...
2026-02-07 17:52:55,455 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #3, history_len=6, prompt_len=83
2026-02-07 17:52:55,456 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 17:52:55,456 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 17:52:55,456 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 17:52:57,159 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 103 events processed
2026-02-07 17:52:57,159 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=526
2026-02-07 17:52:57,160 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 17:52:57,160 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 17:52:57,160 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #3 ended after 4 nodes
2026-02-07 17:52:57,160 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #3 result: response_len=526, needs_viz=True
2026-02-07 17:52:57,160 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Evaluating: needs_viz=True, has_visual=False, attempt=2/2
2026-02-07 17:52:57,160 - src.application.services.visualization_retry_manager - WARNING - [RETRY:chabane.abdelkarim@gmail.com] FAILED: Max retries (2) reached, no visualization produced
2026-02-07 17:52:57,160 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 17:52:57,160 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 17:52:57,160 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'toolvisualizestart{"code": "fig = px.scatter(df, x=\\"Engine Size\\", y=\\"Price\\", title=\\"Corrélation...'
2026-02-07 17:52:57,161 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 17:52:57,161 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 17:52:57,161 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 3 run(s)
2026-02-07 18:18:41,500 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 18:18:41,501 - src.application.services.cancellation_manager - INFO - CancellationManager arrêté
2026-02-07 18:18:41,501 - src.application.services.messaging_service - INFO - Arrêt du MessagingService...
2026-02-07 18:18:41,502 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 18:18:41,503 - src.application.services.messaging_service - INFO - MessagingService déconnecté
2026-02-07 18:18:50,336 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 18:18:50,706 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 18:18:50,724 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 18:18:50,724 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 18:18:50,728 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 18:18:50,728 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 18:18:50,728 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 18:18:50,728 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 18:18:50,731 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 18:18:50,731 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 18:18:50,731 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 18:18:50,731 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 18:19:16,709 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quel est le taux de churn chez les seniors vs n...
2026-02-07 18:19:16,709 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:19:16,710 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=63
2026-02-07 18:19:16,713 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:19:16,713 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:19:16,714 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:19:22,387 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 317 events processed
2026-02-07 18:19:22,387 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:19:22,387 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:19:22,387 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:19:22,417 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:19:22,418 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:19:22,419 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:19:26,751 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 137 events processed
2026-02-07 18:19:26,751 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:19:26,751 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:19:26,752 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:19:26,752 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:19:30,825 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 45 events processed
2026-02-07 18:19:30,826 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:19:30,826 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:19:30,826 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:19:30,826 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:19:31,745 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 44 events processed
2026-02-07 18:19:31,745 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=255
2026-02-07 18:19:31,745 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:19:31,746 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:19:31,746 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 10 nodes
2026-02-07 18:19:32,838 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Judge decision: needs_viz=True
2026-02-07 18:19:32,839 - src.application.services.visualization_retry_manager - INFO - [RETRY:chabane.abdelkarim@gmail.com] Triggering retry 1/2
2026-02-07 18:19:32,840 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Preparing retry with prompt: Crée une visualisation (graphique ou tableau) pour...
2026-02-07 18:19:32,840 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #2, history_len=8, prompt_len=83
2026-02-07 18:19:32,841 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:19:32,841 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:19:32,841 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:19:40,189 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 299 events processed
2026-02-07 18:19:40,190 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:19:40,191 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:19:40,191 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:19:40,352 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 18:19:40,352 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 18:19:40,352 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 18:19:40,355 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:19:40,355 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:19:41,339 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 30 events processed
2026-02-07 18:19:41,340 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=255
2026-02-07 18:19:41,340 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:19:41,340 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:19:41,340 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #2 ended after 6 nodes
2026-02-07 18:19:41,340 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 18:19:41,340 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 18:19:41,340 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 18:19:41,340 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: '```json\n{\n  "response": "Le taux de churn est significativement plus élevé chez les seniors (41.68%)...'
2026-02-07 18:19:41,342 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:19:41,342 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 18:19:41,342 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 2 run(s)
2026-02-07 18:21:21,469 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Combien de clients ont un service de streaming ...
2026-02-07 18:21:21,470 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:21:21,470 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=55
2026-02-07 18:21:21,474 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:21:21,474 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:21:21,475 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:21:23,323 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 71 events processed
2026-02-07 18:21:23,324 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:21:23,324 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:21:23,324 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:21:23,354 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:21:23,355 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:21:23,355 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:21:24,630 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 60 events processed
2026-02-07 18:21:24,630 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=282
2026-02-07 18:21:24,630 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:21:24,630 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:21:24,631 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 6 nodes
2026-02-07 18:24:41,713 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 18:24:41,714 - src.application.services.cancellation_manager - INFO - CancellationManager arrêté
2026-02-07 18:24:41,714 - src.application.services.messaging_service - INFO - Arrêt du MessagingService...
2026-02-07 18:24:41,715 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 18:24:41,715 - src.application.services.messaging_service - INFO - MessagingService déconnecté
2026-02-07 18:24:50,577 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 18:24:50,865 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 18:24:50,882 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 18:24:50,882 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 18:24:50,886 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 18:24:50,886 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 18:24:50,886 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 18:24:50,886 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 18:24:50,888 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 18:24:50,889 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 18:24:50,889 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 18:24:50,889 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 18:25:12,650 - src.application.services.cancellation_manager - INFO - [CANCEL] Signal reçu pour chabane.abdelkarim@gmail.com
2026-02-07 18:25:25,198 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quel pourcentage de clients utilisent les avanc...
2026-02-07 18:25:25,198 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:25:25,198 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=63
2026-02-07 18:25:25,203 - src.application.services.cancellation_manager - INFO - [CANCEL] Arrêt pour chabane.abdelkarim@gmail.com
2026-02-07 18:25:25,203 - src.application.services.cancellation_manager - DEBUG - Cancellation cleared pour chabane.abdelkarim@gmail.com
2026-02-07 18:25:25,206 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:25:25,206 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Cancelled during run #1
2026-02-07 18:25:41,364 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 18:25:41,366 - src.application.services.cancellation_manager - INFO - CancellationManager arrêté
2026-02-07 18:25:41,366 - src.application.services.messaging_service - INFO - Arrêt du MessagingService...
2026-02-07 18:25:41,366 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 18:25:41,366 - src.application.services.messaging_service - INFO - MessagingService déconnecté
2026-02-07 18:25:44,562 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 18:25:44,850 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 18:25:44,867 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 18:25:44,867 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 18:25:44,870 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 18:25:44,870 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 18:25:44,870 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 18:25:44,870 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 18:25:44,872 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 18:25:44,872 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 18:25:44,872 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 18:25:44,872 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 18:25:56,109 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quel pourcentage de clients utilisent les avanc...
2026-02-07 18:25:56,110 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:25:56,110 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=63
2026-02-07 18:25:56,116 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:25:56,116 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:25:56,116 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:25:59,629 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 214 events processed
2026-02-07 18:25:59,630 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:25:59,630 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:25:59,630 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:25:59,658 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:25:59,660 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:25:59,660 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:26:03,755 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 114 events processed
2026-02-07 18:26:03,756 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:26:03,756 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:26:03,756 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:26:03,921 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 18:26:03,921 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 18:26:03,921 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 18:26:03,923 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:26:03,923 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:26:05,393 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 94 events processed
2026-02-07 18:26:05,393 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=172
2026-02-07 18:26:05,393 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:26:05,394 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:26:05,394 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 18:26:05,394 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 18:26:05,394 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 18:26:05,394 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 18:26:05,394 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Environ 48.29% des clients utilisent les avances de cash, ce qui indique que près de la moitié des c...'
2026-02-07 18:26:05,396 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:26:05,396 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 18:26:05,396 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 18:26:19,416 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Y a-t-il une corrélation entre la taille du mot...
2026-02-07 18:26:19,417 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:26:19,417 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=67
2026-02-07 18:26:19,420 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:26:19,420 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:26:19,421 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:26:21,867 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 157 events processed
2026-02-07 18:26:21,867 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:26:21,867 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:26:21,867 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:26:21,893 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:26:21,894 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:26:21,894 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:26:23,652 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 84 events processed
2026-02-07 18:26:23,652 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:26:23,652 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:26:23,652 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:26:23,678 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:26:23,679 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:26:23,679 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:26:26,785 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 122 events processed
2026-02-07 18:26:26,785 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:26:26,785 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:26:26,786 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:26:26,823 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 18:26:26,823 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 18:26:26,823 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 18:26:26,826 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:26:26,827 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:26:30,823 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 182 events processed
2026-02-07 18:26:30,823 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=139
2026-02-07 18:26:30,824 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:26:30,824 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:26:30,824 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 10 nodes
2026-02-07 18:26:30,824 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 18:26:30,824 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 18:26:30,824 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 18:26:30,824 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: "Il existe une corrélation positive entre la taille du moteur et le prix des voitures, mais d'autres ..."
2026-02-07 18:26:30,826 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:26:30,826 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 18:26:30,826 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 18:27:58,049 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Compare les quantités vendues par produit et pa...
2026-02-07 18:27:58,050 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:27:58,050 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=59
2026-02-07 18:27:58,054 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:27:58,054 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:27:58,054 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:28:00,733 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 141 events processed
2026-02-07 18:28:00,733 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:28:00,733 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:28:00,733 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:28:00,761 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:28:00,762 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:28:00,762 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:28:05,633 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 238 events processed
2026-02-07 18:28:05,633 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:28:05,634 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:28:05,634 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:28:05,700 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 18:28:05,700 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 18:28:05,700 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 18:28:05,701 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:28:05,702 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:28:07,873 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 108 events processed
2026-02-07 18:28:07,873 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=407
2026-02-07 18:28:07,873 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:28:07,873 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:28:07,873 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 18:28:07,874 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 18:28:07,874 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 18:28:07,874 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 18:28:07,874 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Le graphique révèle que le "Headset" est le produit le plus vendu en Asie, avec une quantité signifi...'
2026-02-07 18:28:07,874 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:28:07,874 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 18:28:07,874 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 18:29:46,811 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quel est le taux de churn chez les seniors vs n...
2026-02-07 18:29:46,812 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:29:46,812 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=63
2026-02-07 18:29:46,817 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:29:46,817 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:29:46,817 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:29:49,876 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 158 events processed
2026-02-07 18:29:49,876 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:29:49,876 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:29:49,876 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:29:49,906 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:29:49,907 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:29:49,908 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:29:52,331 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 98 events processed
2026-02-07 18:29:52,331 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:29:52,332 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:29:52,332 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:29:52,333 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:29:52,334 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:29:52,334 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:29:54,461 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 72 events processed
2026-02-07 18:29:54,461 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:29:54,461 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:29:54,461 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:29:54,463 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:29:54,464 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:29:54,464 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:29:56,421 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 60 events processed
2026-02-07 18:29:56,422 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:29:56,422 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:29:56,422 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:29:56,478 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 18:29:56,478 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 18:29:56,478 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 18:29:56,479 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:29:56,479 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:29:58,632 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 79 events processed
2026-02-07 18:29:58,632 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=201
2026-02-07 18:29:58,633 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:29:58,633 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:29:58,633 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 12 nodes
2026-02-07 18:29:58,633 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 18:29:58,633 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 18:29:58,633 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 18:29:58,633 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Le taux de churn est significativement plus élevé chez les seniors (41.68%) par rapport aux non-seni...'
2026-02-07 18:29:58,634 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:29:58,634 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 18:29:58,634 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 18:33:13,274 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Montre-moi l'évolution des ventes par mois"...
2026-02-07 18:33:13,276 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:33:13,276 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=46
2026-02-07 18:33:13,282 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:33:13,282 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:33:13,283 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:33:16,954 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 192 events processed
2026-02-07 18:33:16,954 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:33:16,955 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:33:16,955 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:33:16,985 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:33:16,986 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:33:16,986 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:33:19,762 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 115 events processed
2026-02-07 18:33:19,762 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:33:19,763 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:33:19,763 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:33:19,813 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 18:33:19,813 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 18:33:19,813 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 18:33:19,815 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:33:19,815 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:33:22,318 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 140 events processed
2026-02-07 18:33:22,318 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=388
2026-02-07 18:33:22,318 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:33:22,318 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:33:22,319 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 18:33:22,319 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 18:33:22,319 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 18:33:22,319 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 18:33:22,319 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: "Le graphique montre l'évolution des ventes mensuelles de janvier à juillet 2024. On observe une augm..."
2026-02-07 18:33:22,320 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:33:22,320 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 18:33:22,320 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 18:33:57,116 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quelle est la répartition du chiffre d'affaires...
2026-02-07 18:33:57,118 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:33:57,118 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=65
2026-02-07 18:33:57,129 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:33:57,129 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:33:57,130 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:33:59,011 - src.application.services.cancellation_manager - INFO - [CANCEL] Signal reçu pour chabane.abdelkarim@gmail.com
2026-02-07 18:34:01,969 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 335 events processed
2026-02-07 18:34:01,969 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:34:01,970 - src.application.services.cancellation_manager - INFO - [CANCEL] Arrêt pour chabane.abdelkarim@gmail.com
2026-02-07 18:34:01,970 - src.application.services.cancellation_manager - DEBUG - Cancellation cleared pour chabane.abdelkarim@gmail.com
2026-02-07 18:34:01,971 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:34:01,971 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Cancelled during run #1
2026-02-07 18:34:03,199 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quelle est la distribution des types de carbura...
2026-02-07 18:34:03,199 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:34:03,199 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=55
2026-02-07 18:34:03,200 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:34:03,200 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:34:03,200 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:34:05,022 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 96 events processed
2026-02-07 18:34:05,022 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:34:05,022 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:34:05,022 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:34:05,049 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:34:05,050 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:34:05,050 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:34:08,709 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 196 events processed
2026-02-07 18:34:08,709 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:34:08,710 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:34:08,710 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:34:08,754 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 18:34:08,755 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 18:34:08,755 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 18:34:08,756 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:34:08,756 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:34:10,397 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 81 events processed
2026-02-07 18:34:10,397 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=371
2026-02-07 18:34:10,397 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:34:10,398 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:34:10,398 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 18:34:10,398 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 18:34:10,398 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 18:34:10,398 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 18:34:10,398 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Voici la distribution des types de carburant :\n\n![Distribution des types de carburant](output/distri...'
2026-02-07 18:34:10,399 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:34:10,399 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 18:34:10,399 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 18:34:29,435 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Compare le prix moyen entre transmission manuel...
2026-02-07 18:34:29,435 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:34:29,436 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=68
2026-02-07 18:34:29,436 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:34:29,437 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:34:29,437 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:34:33,787 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 77 events processed
2026-02-07 18:34:33,787 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:34:33,788 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:34:33,788 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:34:33,812 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:34:33,813 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:34:33,813 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:34:35,626 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 94 events processed
2026-02-07 18:34:35,626 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=479
2026-02-07 18:34:35,627 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:34:35,627 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:34:35,627 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 6 nodes
2026-02-07 18:34:36,439 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Judge decision: needs_viz=True
2026-02-07 18:34:36,439 - src.application.services.visualization_retry_manager - INFO - [RETRY:chabane.abdelkarim@gmail.com] Triggering retry 1/2
2026-02-07 18:34:36,440 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Preparing retry with prompt: Crée une visualisation (graphique ou tableau) pour...
2026-02-07 18:34:36,441 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #2, history_len=4, prompt_len=83
2026-02-07 18:34:36,441 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:34:36,441 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:34:36,442 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:34:39,873 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 276 events processed
2026-02-07 18:34:39,873 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=479
2026-02-07 18:34:39,873 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:34:39,873 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:34:39,873 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #2 ended after 4 nodes
2026-02-07 18:34:40,993 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Judge decision: needs_viz=True
2026-02-07 18:34:40,993 - src.application.services.visualization_retry_manager - INFO - [RETRY:chabane.abdelkarim@gmail.com] Triggering retry 2/2
2026-02-07 18:34:40,995 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Preparing retry with prompt: Crée une visualisation (graphique ou tableau) pour...
2026-02-07 18:34:40,995 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #3, history_len=6, prompt_len=83
2026-02-07 18:34:40,996 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:34:40,996 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:34:40,996 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:34:44,039 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 243 events processed
2026-02-07 18:34:44,039 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=629
2026-02-07 18:34:44,039 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:34:44,040 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:34:44,040 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #3 ended after 4 nodes
2026-02-07 18:34:44,040 - src.application.services.visualization_retry_manager - WARNING - [RETRY:chabane.abdelkarim@gmail.com] FAILED: Max retries (2) reached
2026-02-07 18:34:44,040 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 18:34:44,040 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 18:34:44,040 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: "```python\nfig = px.bar(df, x='Transmission', y='AveragePrice', title='Comparaison du prix moyen par ..."
2026-02-07 18:34:44,041 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:34:44,041 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 18:34:44,041 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 3 run(s)
2026-02-07 18:36:52,647 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quelle est la taille moteur moyenne par marque ...
2026-02-07 18:36:52,649 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:36:52,649 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=52
2026-02-07 18:36:52,651 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:36:52,652 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:36:52,652 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:36:56,185 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 215 events processed
2026-02-07 18:36:56,185 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:36:56,185 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:36:56,185 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:36:56,216 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:36:56,217 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:36:56,218 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:36:59,675 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 70 events processed
2026-02-07 18:36:59,675 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:36:59,675 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:36:59,675 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:36:59,737 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 18:36:59,737 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 18:36:59,737 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 18:36:59,739 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:36:59,740 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:01,443 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 86 events processed
2026-02-07 18:37:01,443 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=387
2026-02-07 18:37:01,443 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:37:01,444 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:37:01,444 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 18:37:01,444 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 18:37:01,444 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 18:37:01,444 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 18:37:01,444 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'La taille moyenne du moteur est la plus élevée pour Ford (environ 2.857), suivie de près par Honda, ...'
2026-02-07 18:37:01,446 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:37:01,446 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 18:37:01,446 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 18:37:06,785 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quel est le chiffre d'affaires total par région...
2026-02-07 18:37:06,785 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:37:06,785 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=53
2026-02-07 18:37:06,787 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:37:06,787 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:37:06,787 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:08,313 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 57 events processed
2026-02-07 18:37:08,313 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:37:08,314 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:37:08,314 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:37:08,337 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:37:08,338 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:37:08,338 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:10,719 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 71 events processed
2026-02-07 18:37:10,719 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:37:10,720 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:37:10,720 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:37:10,721 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:37:10,722 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:37:10,722 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:16,152 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 125 events processed
2026-02-07 18:37:16,152 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:37:16,153 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:37:16,153 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:37:16,183 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 18:37:16,183 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 18:37:16,183 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 18:37:16,184 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:37:16,184 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:17,547 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 63 events processed
2026-02-07 18:37:17,547 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=243
2026-02-07 18:37:17,548 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:37:17,548 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:37:17,548 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 10 nodes
2026-02-07 18:37:17,548 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 18:37:17,548 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 18:37:17,548 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 18:37:17,548 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: "Le chiffre d'affaires total par région montre que l'Amérique du Sud est en tête avec 294 800,45, sui..."
2026-02-07 18:37:17,550 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:37:17,550 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 18:37:17,550 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 18:37:19,793 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Compare les quantités vendues par produit et pa...
2026-02-07 18:37:19,793 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:37:19,793 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=59
2026-02-07 18:37:19,794 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:37:19,794 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:37:19,794 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:21,207 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 62 events processed
2026-02-07 18:37:21,207 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:37:21,207 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:37:21,207 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:37:21,240 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:37:21,241 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:37:21,241 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:22,904 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 58 events processed
2026-02-07 18:37:22,905 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:37:22,905 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:37:22,905 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:37:22,954 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 18:37:22,954 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 18:37:22,954 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 18:37:22,955 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:37:22,955 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:25,088 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 97 events processed
2026-02-07 18:37:25,089 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=431
2026-02-07 18:37:25,089 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:37:25,089 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:37:25,089 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 18:37:25,089 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 18:37:25,089 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 18:37:25,089 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 18:37:25,090 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Le graphique montre que les Headsets et les Souris (Mouse) sont les produits les plus vendus dans to...'
2026-02-07 18:37:25,091 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:37:25,091 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 18:37:25,091 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 18:37:26,383 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Montre la relation entre le kilométrage et le p...
2026-02-07 18:37:26,383 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:37:26,383 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=54
2026-02-07 18:37:26,384 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:37:26,385 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:37:26,385 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:26,548 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 134, in _process_request
    buffer, _ = await self._stream_processor.process_node(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        node, run.ctx, email, buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 53, in process_node
    buffer = await self._handle_model_request(node, ctx, email, buffer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 74, in _handle_model_request
    async with node.stream(ctx) as stream:
               ~~~~~~~~~~~^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 213, in request_stream
    response = await self._stream_completions_create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        messages, cast(MistralModelSettings, model_settings or {}), model_request_parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 266, in _stream_completions_create
    response = await self.client.chat.stream_async(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/mistralai/chat.py", line 761, in stream_async
    raise models.SDKError("API error occurred", http_res, http_res_text)
mistralai.models.sdkerror.SDKError: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:37:26,555 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:37:26,556 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:37:29,488 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Montre la relation entre le kilométrage et le p...
2026-02-07 18:37:29,488 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:37:29,488 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=54
2026-02-07 18:37:29,489 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:37:29,490 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:37:29,490 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:29,652 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 134, in _process_request
    buffer, _ = await self._stream_processor.process_node(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        node, run.ctx, email, buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 53, in process_node
    buffer = await self._handle_model_request(node, ctx, email, buffer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 74, in _handle_model_request
    async with node.stream(ctx) as stream:
               ~~~~~~~~~~~^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 213, in request_stream
    response = await self._stream_completions_create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        messages, cast(MistralModelSettings, model_settings or {}), model_request_parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 266, in _stream_completions_create
    response = await self.client.chat.stream_async(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/mistralai/chat.py", line 761, in stream_async
    raise models.SDKError("API error occurred", http_res, http_res_text)
mistralai.models.sdkerror.SDKError: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:37:29,653 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:37:29,655 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:37:34,866 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Montre la relation entre le kilométrage et le p...
2026-02-07 18:37:34,866 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:37:34,866 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=54
2026-02-07 18:37:34,867 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:37:34,867 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:37:34,867 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:35,146 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 134, in _process_request
    buffer, _ = await self._stream_processor.process_node(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        node, run.ctx, email, buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 53, in process_node
    buffer = await self._handle_model_request(node, ctx, email, buffer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 74, in _handle_model_request
    async with node.stream(ctx) as stream:
               ~~~~~~~~~~~^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 213, in request_stream
    response = await self._stream_completions_create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        messages, cast(MistralModelSettings, model_settings or {}), model_request_parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 266, in _stream_completions_create
    response = await self.client.chat.stream_async(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/mistralai/chat.py", line 761, in stream_async
    raise models.SDKError("API error occurred", http_res, http_res_text)
mistralai.models.sdkerror.SDKError: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:37:35,149 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:37:35,150 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:37:47,859 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Montre la relation entre le kilométrage et le p...
2026-02-07 18:37:47,861 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:37:47,861 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=54
2026-02-07 18:37:47,864 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:37:47,864 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:37:47,865 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:48,154 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 134, in _process_request
    buffer, _ = await self._stream_processor.process_node(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        node, run.ctx, email, buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 53, in process_node
    buffer = await self._handle_model_request(node, ctx, email, buffer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 74, in _handle_model_request
    async with node.stream(ctx) as stream:
               ~~~~~~~~~~~^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 213, in request_stream
    response = await self._stream_completions_create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        messages, cast(MistralModelSettings, model_settings or {}), model_request_parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 266, in _stream_completions_create
    response = await self.client.chat.stream_async(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/mistralai/chat.py", line 761, in stream_async
    raise models.SDKError("API error occurred", http_res, http_res_text)
mistralai.models.sdkerror.SDKError: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:37:48,156 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:37:48,157 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:37:54,466 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Montre la relation entre le kilométrage et le p...
2026-02-07 18:37:54,467 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:37:54,467 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=54
2026-02-07 18:37:54,468 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:37:54,468 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:37:54,469 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:37:54,748 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 134, in _process_request
    buffer, _ = await self._stream_processor.process_node(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        node, run.ctx, email, buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 53, in process_node
    buffer = await self._handle_model_request(node, ctx, email, buffer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 74, in _handle_model_request
    async with node.stream(ctx) as stream:
               ~~~~~~~~~~~^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 213, in request_stream
    response = await self._stream_completions_create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        messages, cast(MistralModelSettings, model_settings or {}), model_request_parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 266, in _stream_completions_create
    response = await self.client.chat.stream_async(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/mistralai/chat.py", line 761, in stream_async
    raise models.SDKError("API error occurred", http_res, http_res_text)
mistralai.models.sdkerror.SDKError: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:37:54,749 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:37:54,750 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 18:38:09,499 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Montre la relation entre le kilométrage et le p...
2026-02-07 18:38:09,499 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 18:38:09,499 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=54
2026-02-07 18:38:09,501 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 18:38:09,501 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 18:38:09,501 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:38:13,426 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 253 events processed
2026-02-07 18:38:13,426 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:38:13,426 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:38:13,427 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 18:38:13,451 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 18:38:13,452 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:38:13,452 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:38:14,807 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 44 events processed
2026-02-07 18:38:14,807 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 18:38:14,807 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 18:38:14,807 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 18:38:14,862 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 18:38:14,862 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 18:38:14,862 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 18:38:14,864 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 18:38:14,864 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 18:38:15,121 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 134, in _process_request
    buffer, _ = await self._stream_processor.process_node(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        node, run.ctx, email, buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 53, in process_node
    buffer = await self._handle_model_request(node, ctx, email, buffer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 74, in _handle_model_request
    async with node.stream(ctx) as stream:
               ~~~~~~~~~~~^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 213, in request_stream
    response = await self._stream_completions_create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        messages, cast(MistralModelSettings, model_settings or {}), model_request_parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 266, in _stream_completions_create
    response = await self.client.chat.stream_async(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/mistralai/chat.py", line 761, in stream_async
    raise models.SDKError("API error occurred", http_res, http_res_text)
mistralai.models.sdkerror.SDKError: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:38:15,122 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 18:38:15,123 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:00:06,381 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Comment le prix évolue-t-il en fonction de l'an...
2026-02-07 19:00:06,387 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:00:06,387 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=56
2026-02-07 19:00:06,390 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:00:06,390 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:00:06,390 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:00:09,378 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 132 events processed
2026-02-07 19:00:09,378 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:00:09,378 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:00:09,378 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:00:09,414 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:00:09,415 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:00:09,416 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:00:14,720 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 255 events processed
2026-02-07 19:00:14,721 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:00:14,721 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:00:14,721 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:00:14,767 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 19:00:14,767 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:00:14,767 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:00:14,769 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:00:14,770 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:00:16,704 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 96 events processed
2026-02-07 19:00:16,704 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=323
2026-02-07 19:00:16,705 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:00:16,705 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:00:16,705 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 19:00:16,705 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 19:00:16,705 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 19:00:16,705 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:00:16,705 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Le graphique montre que le prix moyen des voitures a généralement augmenté de 2000 à 2020. On observ...'
2026-02-07 19:00:16,707 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:00:16,707 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 19:00:16,707 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 19:01:12,859 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quel est le prix unitaire moyen par produit ?"...
2026-02-07 19:01:12,860 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:01:12,861 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=49
2026-02-07 19:01:12,866 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:01:12,866 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:01:12,867 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:01:15,465 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 138 events processed
2026-02-07 19:01:15,466 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:01:15,466 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:01:15,466 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:01:15,491 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:01:15,493 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:01:15,493 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:01:16,895 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 50 events processed
2026-02-07 19:01:16,895 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:01:16,895 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:01:16,895 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:01:16,955 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 19:01:16,955 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:01:16,955 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:01:16,957 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:01:16,957 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:01:19,388 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 188 events processed
2026-02-07 19:01:19,388 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=312
2026-02-07 19:01:19,389 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:01:19,389 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:01:19,389 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 19:01:19,389 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 19:01:19,389 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 19:01:19,390 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:01:19,390 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Le prix unitaire moyen par produit varie significativement. Les souris et les tablettes ont les prix...'
2026-02-07 19:01:19,390 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:01:19,390 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 19:01:19,391 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 19:01:29,412 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quels facteurs sont corrélés au churn ?"...
2026-02-07 19:01:29,412 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:01:29,412 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=43
2026-02-07 19:01:29,413 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:01:29,413 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:01:29,413 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:01:33,897 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 230 events processed
2026-02-07 19:01:33,897 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:01:33,898 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:01:33,898 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:01:33,925 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:01:33,925 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:01:33,926 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:01:39,119 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 210 events processed
2026-02-07 19:01:39,119 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:01:39,120 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:01:39,120 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:01:39,166 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 19:01:39,166 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:01:39,166 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:01:39,168 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:01:39,168 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:01:39,447 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 134, in _process_request
    buffer, _ = await self._stream_processor.process_node(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        node, run.ctx, email, buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 53, in process_node
    buffer = await self._handle_model_request(node, ctx, email, buffer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 74, in _handle_model_request
    async with node.stream(ctx) as stream:
               ~~~~~~~~~~~^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 213, in request_stream
    response = await self._stream_completions_create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        messages, cast(MistralModelSettings, model_settings or {}), model_request_parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 266, in _stream_completions_create
    response = await self.client.chat.stream_async(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/mistralai/chat.py", line 761, in stream_async
    raise models.SDKError("API error occurred", http_res, http_res_text)
mistralai.models.sdkerror.SDKError: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 19:01:39,449 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 19:01:39,450 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:01:51,619 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quelle méthode de paiement a le plus haut taux ...
2026-02-07 19:01:51,619 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:01:51,619 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=61
2026-02-07 19:01:51,620 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:01:51,621 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:01:51,621 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:01:54,610 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 151 events processed
2026-02-07 19:01:54,610 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:01:54,610 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:01:54,610 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:01:54,638 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:01:54,640 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:01:54,640 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:01:54,798 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 134, in _process_request
    buffer, _ = await self._stream_processor.process_node(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        node, run.ctx, email, buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 53, in process_node
    buffer = await self._handle_model_request(node, ctx, email, buffer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 74, in _handle_model_request
    async with node.stream(ctx) as stream:
               ~~~~~~~~~~~^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 213, in request_stream
    response = await self._stream_completions_create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        messages, cast(MistralModelSettings, model_settings or {}), model_request_parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 266, in _stream_completions_create
    response = await self.client.chat.stream_async(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/mistralai/chat.py", line 761, in stream_async
    raise models.SDKError("API error occurred", http_res, http_res_text)
mistralai.models.sdkerror.SDKError: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 19:01:54,800 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 19:01:54,801 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:02:31,995 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Combien de clients ont un service de streaming ...
2026-02-07 19:02:31,996 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:02:31,996 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=55
2026-02-07 19:02:32,004 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:02:32,004 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:02:32,006 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:02:33,754 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 69 events processed
2026-02-07 19:02:33,754 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:02:33,754 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:02:33,754 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:02:33,781 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:02:33,782 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:02:33,783 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:02:35,436 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 96 events processed
2026-02-07 19:02:35,436 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=283
2026-02-07 19:02:35,436 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:02:35,437 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:02:35,437 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 6 nodes
2026-02-07 19:02:36,491 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Judge decision: needs_viz=True
2026-02-07 19:02:36,491 - src.application.services.visualization_retry_manager - INFO - [RETRY:chabane.abdelkarim@gmail.com] Triggering retry 1/2
2026-02-07 19:02:36,492 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Preparing retry with prompt: Crée une visualisation (graphique ou tableau) pour...
2026-02-07 19:02:36,492 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #2, history_len=4, prompt_len=83
2026-02-07 19:02:36,493 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:02:36,493 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:02:36,493 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:02:40,664 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 95 events processed
2026-02-07 19:02:40,665 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=292
2026-02-07 19:02:40,666 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:02:40,666 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:02:40,666 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #2 ended after 4 nodes
2026-02-07 19:02:41,912 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Judge decision: needs_viz=True
2026-02-07 19:02:41,912 - src.application.services.visualization_retry_manager - INFO - [RETRY:chabane.abdelkarim@gmail.com] Triggering retry 2/2
2026-02-07 19:02:41,914 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Preparing retry with prompt: Crée une visualisation (graphique ou tableau) pour...
2026-02-07 19:02:41,914 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #3, history_len=6, prompt_len=83
2026-02-07 19:02:41,915 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:02:41,915 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:02:41,915 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:02:43,009 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 43 events processed
2026-02-07 19:02:43,009 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:02:43,009 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:02:43,009 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:02:43,037 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:02:43,038 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:02:43,038 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:02:44,303 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 63 events processed
2026-02-07 19:02:44,303 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=292
2026-02-07 19:02:44,303 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:02:44,303 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:02:44,304 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #3 ended after 6 nodes
2026-02-07 19:02:44,304 - src.application.services.visualization_retry_manager - WARNING - [RETRY:chabane.abdelkarim@gmail.com] FAILED: Max retries (2) reached
2026-02-07 19:02:44,304 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 19:02:44,304 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:02:44,304 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'toolvisualizestart{"code": "result = pd.DataFrame({\\"Metric\\": [\\"Clients avec Streaming TV\\"], \\"Va...'
2026-02-07 19:02:44,305 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:02:44,305 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 19:02:44,305 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 3 run(s)
2026-02-07 19:22:52,791 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:22:52,793 - src.application.services.cancellation_manager - INFO - CancellationManager arrêté
2026-02-07 19:22:52,793 - src.application.services.messaging_service - INFO - Arrêt du MessagingService...
2026-02-07 19:22:52,794 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:22:52,794 - src.application.services.messaging_service - INFO - MessagingService déconnecté
2026-02-07 19:22:54,701 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 19:22:54,991 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 19:22:55,010 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 19:22:55,010 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 19:22:55,013 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:22:55,013 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 19:22:55,013 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 19:22:55,013 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 19:22:55,015 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:22:55,015 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 19:22:55,015 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 19:22:55,015 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 19:23:10,230 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Comment le prix évolue-t-il en fonction de l'an...
2026-02-07 19:23:10,230 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:23:10,231 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=56
2026-02-07 19:23:10,241 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:23:10,242 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:23:10,243 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:23:13,034 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 142 events processed
2026-02-07 19:23:13,034 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:23:13,034 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:23:13,034 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:23:13,063 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:23:13,064 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:23:13,065 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:23:14,904 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 95 events processed
2026-02-07 19:23:14,904 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=413
2026-02-07 19:23:14,904 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:23:14,905 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:23:14,905 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 6 nodes
2026-02-07 19:23:15,956 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Judge decision: needs_viz=True
2026-02-07 19:23:15,956 - src.application.services.visualization_retry_manager - INFO - [RETRY:chabane.abdelkarim@gmail.com] Triggering retry 1/2
2026-02-07 19:23:15,957 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:23:15,957 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'toolvisualizestart{"code": "fig = px.line(df, x=\'Year\', y=\'AveragePrice\', markers=True, title=\'Évolu...'
2026-02-07 19:23:15,958 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:23:15,958 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed (DONE sent)
2026-02-07 19:23:15,958 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 19:28:29,967 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:28:29,968 - src.application.services.cancellation_manager - INFO - CancellationManager arrêté
2026-02-07 19:28:29,968 - src.application.services.messaging_service - INFO - Arrêt du MessagingService...
2026-02-07 19:28:29,969 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:28:29,969 - src.application.services.messaging_service - INFO - MessagingService déconnecté
2026-02-07 19:28:31,755 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 19:28:32,046 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 19:28:32,062 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 19:28:32,062 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 19:28:32,065 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:28:32,066 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 19:28:32,066 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 19:28:32,066 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 19:28:32,068 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:28:32,068 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 19:28:32,068 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 19:28:32,068 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 19:28:46,875 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quelle est la répartition du chiffre d'affaires...
2026-02-07 19:28:46,876 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:28:46,876 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=65
2026-02-07 19:28:46,880 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:28:46,880 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:28:46,881 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:28:49,094 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 110 events processed
2026-02-07 19:28:49,095 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:28:49,095 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:28:49,095 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:28:49,122 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:28:49,123 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:28:49,123 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:28:51,084 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 73 events processed
2026-02-07 19:28:51,084 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:28:51,085 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:28:51,085 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:28:51,262 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 19:28:51,262 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:28:51,262 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:28:51,263 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:28:51,263 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:28:56,392 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 184 events processed
2026-02-07 19:28:56,393 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=374
2026-02-07 19:28:56,393 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:28:56,393 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:28:56,394 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 19:28:56,394 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 19:28:56,394 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 19:28:56,394 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:28:56,394 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Le graphique montre que les moniteurs, les casques et les téléphones sont les produits générant le p...'
2026-02-07 19:28:56,395 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:28:56,395 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed
2026-02-07 19:28:56,395 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 19:29:52,754 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:29:52,755 - src.application.services.cancellation_manager - INFO - CancellationManager arrêté
2026-02-07 19:29:52,755 - src.application.services.messaging_service - INFO - Arrêt du MessagingService...
2026-02-07 19:29:52,756 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:29:52,756 - src.application.services.messaging_service - INFO - MessagingService déconnecté
2026-02-07 19:29:54,331 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 19:29:54,676 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 19:29:54,693 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 19:29:54,693 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 19:29:54,696 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:29:54,697 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 19:29:54,697 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 19:29:54,697 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 19:29:54,698 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:29:54,698 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 19:29:54,698 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 19:29:54,698 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 19:30:01,612 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quelle est la répartition du chiffre d'affaires...
2026-02-07 19:30:01,612 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:30:01,612 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=65
2026-02-07 19:30:01,616 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:30:01,616 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:30:01,617 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:30:06,311 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 347 events processed
2026-02-07 19:30:06,311 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:30:06,312 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:30:06,312 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:30:06,337 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:30:06,337 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:30:06,338 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:30:09,958 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 307 events processed
2026-02-07 19:30:09,959 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=494
2026-02-07 19:30:09,959 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:30:09,959 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:30:09,959 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 6 nodes
2026-02-07 19:31:22,779 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quelle est la répartition du chiffre d'affaires...
2026-02-07 19:31:22,779 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:31:22,781 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=65
2026-02-07 19:31:22,792 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:31:22,792 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:31:22,793 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:31:24,844 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 100 events processed
2026-02-07 19:31:24,844 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:31:24,845 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:31:24,845 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:31:24,870 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:31:24,871 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:31:24,871 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:31:26,185 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 30 events processed
2026-02-07 19:31:26,186 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:31:26,186 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:31:26,186 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:31:26,368 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 19:31:26,368 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:31:26,368 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:31:26,369 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:31:26,370 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:31:28,039 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 86 events processed
2026-02-07 19:31:28,039 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=366
2026-02-07 19:31:28,039 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:31:28,039 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:31:28,040 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 19:31:28,040 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 19:31:28,040 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 19:31:28,040 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:31:28,040 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: La visualisation n'a pas pu être générée. Pourriez-vous reformuler votre question ?
2026-02-07 19:31:28,041 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:31:28,041 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed
2026-02-07 19:31:28,041 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 19:33:02,412 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:33:02,413 - src.application.services.cancellation_manager - INFO - CancellationManager arrêté
2026-02-07 19:33:02,413 - src.application.services.messaging_service - INFO - Arrêt du MessagingService...
2026-02-07 19:33:02,414 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:33:02,414 - src.application.services.messaging_service - INFO - MessagingService déconnecté
2026-02-07 19:33:04,392 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 19:33:04,694 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 19:33:04,711 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 19:33:04,711 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 19:33:04,714 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:33:04,714 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 19:33:04,714 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 19:33:04,714 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 19:33:04,716 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:33:04,716 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 19:33:04,716 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 19:33:04,716 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 19:33:09,225 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quelle est la répartition du chiffre d'affaires...
2026-02-07 19:33:09,225 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:33:09,225 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=65
2026-02-07 19:33:09,230 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:33:09,230 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:33:09,230 - src.application.services.visualization_retry_manager - WARNING - [RETRY:chabane.abdelkarim@gmail.com] Judge agent failed: 'NoneType' object has no attribute 'all_messages', defaulting to retry
2026-02-07 19:33:09,230 - src.application.services.visualization_retry_manager - INFO - [RETRY:chabane.abdelkarim@gmail.com] Triggering retry 1/2
2026-02-07 19:33:09,233 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: 'NoneType' object has no attribute 'all_messages'
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 140, in _process_request
    decision = await self._retry_manager.evaluate_run(email, run)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/visualization_retry_manager.py", line 130, in evaluate_run
    message_history=run.result.all_messages(),
                    ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'all_messages'
2026-02-07 19:33:09,234 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: 'NoneType' object has no attribute 'all_messages'
2026-02-07 19:33:09,235 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:33:34,135 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:33:34,135 - src.application.services.cancellation_manager - INFO - CancellationManager arrêté
2026-02-07 19:33:34,135 - src.application.services.messaging_service - INFO - Arrêt du MessagingService...
2026-02-07 19:33:34,135 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:33:34,135 - src.application.services.messaging_service - INFO - MessagingService déconnecté
2026-02-07 19:33:35,806 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 19:33:36,103 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 19:33:36,119 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 19:33:36,119 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 19:33:36,122 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:33:36,123 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 19:33:36,123 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 19:33:36,123 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 19:33:36,125 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:33:36,125 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 19:33:36,125 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 19:33:36,125 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 19:33:52,255 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quels facteurs sont corrélés au churn ?"...
2026-02-07 19:33:52,255 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:33:52,255 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=43
2026-02-07 19:33:52,259 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:33:52,259 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:33:52,260 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:33:58,976 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 454 events processed
2026-02-07 19:33:58,977 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:33:58,978 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:33:58,978 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:33:59,003 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:33:59,004 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:33:59,004 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:34:05,027 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 409 events processed
2026-02-07 19:34:05,027 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:34:05,028 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:34:05,028 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:34:05,061 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:34:05,062 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:34:05,062 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:34:29,487 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:34:29,488 - src.application.services.cancellation_manager - INFO - CancellationManager arrêté
2026-02-07 19:34:29,488 - src.application.services.messaging_service - INFO - Arrêt du MessagingService...
2026-02-07 19:34:29,488 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 19:34:29,488 - src.application.services.messaging_service - INFO - MessagingService déconnecté
2026-02-07 19:34:31,805 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 19:34:32,089 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 19:34:32,130 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 19:34:32,130 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 19:34:32,144 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:34:32,145 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 19:34:32,145 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 19:34:32,145 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 19:34:32,147 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 19:34:32,147 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 19:34:32,147 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 19:34:32,147 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 19:34:37,522 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quels facteurs sont corrélés au churn ?"...
2026-02-07 19:34:37,522 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:34:37,522 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=43
2026-02-07 19:34:37,528 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:34:37,528 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:34:37,528 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:34:40,849 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 180 events processed
2026-02-07 19:34:40,849 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:34:40,849 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:34:40,849 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:34:40,878 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:34:40,879 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:34:40,879 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:34:43,988 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 112 events processed
2026-02-07 19:34:43,989 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:34:43,990 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:34:43,990 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:34:44,126 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 19:34:44,127 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:34:44,127 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:34:44,129 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:34:44,129 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:34:47,181 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 229 events processed
2026-02-07 19:34:47,181 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=377
2026-02-07 19:34:47,182 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:34:47,182 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:34:47,182 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 19:34:47,182 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 19:34:47,182 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 19:34:47,182 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:34:47,182 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Les facteurs les plus corrélés au churn sont les charges mensuelles (`MonthlyCharges`) et les charge...'
2026-02-07 19:34:47,183 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:34:47,183 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed
2026-02-07 19:34:47,183 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 19:34:56,451 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Montre la relation entre le kilométrage et le p...
2026-02-07 19:34:56,452 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:34:56,453 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=54
2026-02-07 19:34:56,456 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:34:56,456 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:34:56,456 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:34:56,741 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 134, in _process_request
    buffer, _ = await self._stream_processor.process_node(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        node, run.ctx, email, buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 53, in process_node
    buffer = await self._handle_model_request(node, ctx, email, buffer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 74, in _handle_model_request
    async with node.stream(ctx) as stream:
               ~~~~~~~~~~~^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 213, in request_stream
    response = await self._stream_completions_create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        messages, cast(MistralModelSettings, model_settings or {}), model_request_parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 266, in _stream_completions_create
    response = await self.client.chat.stream_async(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/mistralai/chat.py", line 761, in stream_async
    raise models.SDKError("API error occurred", http_res, http_res_text)
mistralai.models.sdkerror.SDKError: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 19:34:56,747 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 19:34:56,748 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:35:02,477 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Montre la relation entre le kilométrage et le p...
2026-02-07 19:35:02,477 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:35:02,477 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=54
2026-02-07 19:35:02,478 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:35:02,478 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:35:02,478 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:35:05,315 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 170 events processed
2026-02-07 19:35:05,315 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:35:05,315 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:35:05,315 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:35:05,337 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:35:05,338 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:35:05,338 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:35:06,769 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 55 events processed
2026-02-07 19:35:06,769 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:35:06,770 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:35:06,770 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:35:06,806 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 19:35:06,807 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:35:06,807 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:35:06,808 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:35:06,809 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:35:07,044 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 134, in _process_request
    buffer, _ = await self._stream_processor.process_node(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        node, run.ctx, email, buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 53, in process_node
    buffer = await self._handle_model_request(node, ctx, email, buffer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 74, in _handle_model_request
    async with node.stream(ctx) as stream:
               ~~~~~~~~~~~^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 213, in request_stream
    response = await self._stream_completions_create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        messages, cast(MistralModelSettings, model_settings or {}), model_request_parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 266, in _stream_completions_create
    response = await self.client.chat.stream_async(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/mistralai/chat.py", line 761, in stream_async
    raise models.SDKError("API error occurred", http_res, http_res_text)
mistralai.models.sdkerror.SDKError: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 19:35:07,045 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 19:35:07,046 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:44:14,487 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Compare le prix moyen entre transmission manuel...
2026-02-07 19:44:14,488 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:44:14,488 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=68
2026-02-07 19:44:14,491 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:44:14,491 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:44:14,492 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:44:17,303 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 176 events processed
2026-02-07 19:44:17,303 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:44:17,303 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:44:17,304 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:44:17,341 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:44:17,342 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:44:17,343 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:44:20,994 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 148 events processed
2026-02-07 19:44:20,995 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:44:20,995 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:44:20,995 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:44:21,047 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 19:44:21,047 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:44:21,048 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:44:21,049 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:44:21,049 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:44:22,922 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 129 events processed
2026-02-07 19:44:22,922 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=312
2026-02-07 19:44:22,923 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:44:22,923 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:44:22,924 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 19:44:22,924 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 19:44:22,925 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 19:44:22,926 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:44:22,926 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Le graphique comparant le prix moyen par type de transmission montre que les véhicules avec transmis...'
2026-02-07 19:44:22,932 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:44:22,933 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed
2026-02-07 19:44:22,933 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 19:44:28,846 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quel est le taux de churn chez les seniors vs n...
2026-02-07 19:44:28,847 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:44:28,847 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=63
2026-02-07 19:44:28,853 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:44:28,853 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:44:28,853 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:44:31,379 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 113 events processed
2026-02-07 19:44:31,379 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:44:31,379 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:44:31,379 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:44:31,410 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:44:31,411 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:44:31,411 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:44:33,161 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 67 events processed
2026-02-07 19:44:33,161 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:44:33,162 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:44:33,162 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:44:33,221 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 19:44:33,222 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:44:33,222 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:44:33,223 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:44:33,223 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:44:35,880 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 198 events processed
2026-02-07 19:44:35,880 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=349
2026-02-07 19:44:35,881 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:44:35,881 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:44:35,881 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 19:44:35,882 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 19:44:35,882 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 19:44:35,882 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:44:35,882 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Voici le graphique comparant le taux de churn chez les seniors et les non-seniors :\n\n![Graphique](ou...'
2026-02-07 19:44:35,883 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:44:35,883 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed
2026-02-07 19:44:35,883 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 19:44:49,603 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Comment le tenure (ancienneté) influence-t-il l...
2026-02-07 19:44:49,604 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:44:49,604 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=60
2026-02-07 19:44:49,605 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:44:49,605 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:44:49,605 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:45:02,722 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 811 events processed
2026-02-07 19:45:02,723 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:45:02,723 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:45:02,724 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:45:02,751 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:45:02,751 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:45:02,751 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:45:06,684 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 193 events processed
2026-02-07 19:45:06,684 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:45:06,685 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:45:06,685 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:45:06,725 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 19:45:06,725 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:45:06,725 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:45:06,727 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:45:06,727 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:45:09,145 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 121 events processed
2026-02-07 19:45:09,146 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=591
2026-02-07 19:45:09,147 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:45:09,147 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:45:09,147 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 19:45:09,148 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 19:45:09,148 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 19:45:09,148 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:45:09,148 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Le graphique "Taux de Churn par Groupe d\'Ancienneté" montre que le taux de churn est plus élevé pour...'
2026-02-07 19:45:09,149 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:45:09,149 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed
2026-02-07 19:45:09,149 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 19:45:30,379 - src.application.services.cancellation_manager - INFO - [CANCEL] Signal reçu pour chabane.abdelkarim@gmail.com
2026-02-07 19:45:31,682 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Comment le tenure (ancienneté) influence-t-il l...
2026-02-07 19:45:31,682 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:45:31,682 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=60
2026-02-07 19:45:31,686 - src.application.services.cancellation_manager - INFO - [CANCEL] Arrêt pour chabane.abdelkarim@gmail.com
2026-02-07 19:45:31,686 - src.application.services.cancellation_manager - DEBUG - Cancellation cleared pour chabane.abdelkarim@gmail.com
2026-02-07 19:45:31,687 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:45:31,687 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Cancelled during run #1
2026-02-07 19:45:51,774 - src.application.services.cancellation_manager - INFO - [CANCEL] Signal reçu pour chabane.abdelkarim@gmail.com
2026-02-07 19:45:56,928 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Comment le tenure (ancienneté) influence-t-il l...
2026-02-07 19:45:56,928 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:45:56,928 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=60
2026-02-07 19:45:56,930 - src.application.services.cancellation_manager - INFO - [CANCEL] Arrêt pour chabane.abdelkarim@gmail.com
2026-02-07 19:45:56,930 - src.application.services.cancellation_manager - DEBUG - Cancellation cleared pour chabane.abdelkarim@gmail.com
2026-02-07 19:45:56,931 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:45:56,931 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Cancelled during run #1
2026-02-07 19:46:08,936 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Comment le tenure (ancienneté) influence-t-il l...
2026-02-07 19:46:08,937 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:46:08,937 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=60
2026-02-07 19:46:08,940 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:46:08,940 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:46:08,940 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:46:14,020 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 236 events processed
2026-02-07 19:46:14,020 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:46:14,020 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:46:14,020 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:46:14,048 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:46:14,049 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:46:14,049 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:46:19,258 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 449 events processed
2026-02-07 19:46:19,258 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=587
2026-02-07 19:46:19,259 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:46:19,259 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:46:19,259 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 6 nodes
2026-02-07 19:46:20,862 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Judge decision: needs_viz=True
2026-02-07 19:46:20,862 - src.application.services.visualization_retry_manager - INFO - [RETRY:chabane.abdelkarim@gmail.com] Triggering retry 1/2
2026-02-07 19:46:20,863 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Preparing retry with prompt: Crée une visualisation (graphique ou tableau) pour...
2026-02-07 19:46:20,863 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #2, history_len=4, prompt_len=83
2026-02-07 19:46:20,864 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:46:20,864 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:46:20,864 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:46:23,154 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 88 events processed
2026-02-07 19:46:23,155 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:46:23,155 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:46:23,155 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:46:23,290 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 19:46:23,290 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:46:23,290 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:46:23,293 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:46:23,294 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:46:25,166 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 66 events processed
2026-02-07 19:46:25,167 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=434
2026-02-07 19:46:25,168 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:46:25,168 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:46:25,168 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #2 ended after 6 nodes
2026-02-07 19:46:25,168 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 19:46:25,168 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 19:46:25,168 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:46:25,168 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: 'Le graphique à barres montre que le taux de churn est le plus élevé (47.44%) pour les clients avec u...'
2026-02-07 19:46:25,169 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:46:25,170 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed
2026-02-07 19:46:25,170 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 2 run(s)
2026-02-07 19:46:37,158 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: taux de churn le plus eleve...
2026-02-07 19:46:37,159 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started, state initialized
2026-02-07 19:46:37,160 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=27
2026-02-07 19:46:37,162 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 19:46:37,162 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 19:46:37,163 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:46:40,545 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 197 events processed
2026-02-07 19:46:40,545 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:46:40,546 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:46:40,546 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 19:46:40,570 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 19:46:40,571 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:46:40,571 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:46:42,977 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 121 events processed
2026-02-07 19:46:42,978 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 19:46:42,978 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:46:42,978 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 19:46:42,985 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=data_table
2026-02-07 19:46:42,985 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 19:46:42,985 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded (has_visual=True)
2026-02-07 19:46:42,985 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:46:42,985 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 19:46:44,091 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 81 events processed
2026-02-07 19:46:44,091 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=120
2026-02-07 19:46:44,091 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 19:46:44,091 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 19:46:44,091 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended after 8 nodes
2026-02-07 19:46:44,091 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: Visual was produced
2026-02-07 19:46:44,091 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 19:46:44,092 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] No retry needed, publishing final response
2026-02-07 19:46:44,092 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing final: "Le taux de churn le plus élevé est d'environ 26.54%. Cela indique que près d'un quart des clients on..."
2026-02-07 19:46:44,093 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 19:46:44,093 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Stream completed
2026-02-07 19:46:44,093 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 20:20:24,212 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 20:20:24,213 - src.application.services.cancellation_manager - INFO - CancellationManager arrêté
2026-02-07 20:20:24,213 - src.application.services.messaging_service - INFO - Arrêt du MessagingService...
2026-02-07 20:20:24,215 - src.infrastructure.adapters.redis_channel_adapter - INFO - Deconnecte de Redis
2026-02-07 20:20:24,215 - src.application.services.messaging_service - INFO - MessagingService déconnecté
2026-02-07 20:20:31,822 - asyncio - DEBUG - Using selector: KqueueSelector
2026-02-07 20:20:32,108 - src.application.services.dataset_loader - INFO - Chargé 4 dataset(s)
2026-02-07 20:20:32,127 - src.application.data_analysis_agent - INFO - Agent initialisé avec 4 dataset(s)
2026-02-07 20:20:32,127 - src.application.services.messaging_service - INFO - Démarrage du MessagingService sur inbox:*...
2026-02-07 20:20:32,131 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 20:20:32,131 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: inbox:*
2026-02-07 20:20:32,131 - src.application.services.messaging_service - INFO - MessagingService connecté et en écoute
2026-02-07 20:20:32,131 - src.application.services.cancellation_manager - INFO - Démarrage CancellationManager sur cancel:*...
2026-02-07 20:20:32,133 - src.infrastructure.adapters.redis_channel_adapter - INFO - Connecte a Redis: redis://localhost:6379
2026-02-07 20:20:32,133 - src.infrastructure.adapters.redis_channel_adapter - INFO - Abonne au pattern: cancel:*
2026-02-07 20:20:32,133 - src.application.services.cancellation_manager - INFO - CancellationManager démarré
2026-02-07 20:20:32,133 - src.application.data_analysis_agent - INFO - DataAnalysisAgent en écoute...
2026-02-07 20:20:49,630 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quelles sont les 10 voitures les plus chères ?"...
2026-02-07 20:20:49,631 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started
2026-02-07 20:20:49,631 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=50
2026-02-07 20:20:49,653 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 20:20:49,653 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 20:20:49,654 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:20:51,610 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 82 events processed
2026-02-07 20:20:51,610 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 20:20:51,611 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:20:51,611 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 20:20:51,639 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 20:20:51,641 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:20:51,641 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:20:52,079 - src.application.services.cancellation_manager - INFO - [CANCEL] Signal reçu pour chabane.abdelkarim@gmail.com
2026-02-07 20:20:53,455 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 73 events processed
2026-02-07 20:20:53,455 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 20:20:53,455 - src.application.services.cancellation_manager - INFO - [CANCEL] Arrêt pour chabane.abdelkarim@gmail.com
2026-02-07 20:20:53,455 - src.application.services.cancellation_manager - DEBUG - Cancellation cleared pour chabane.abdelkarim@gmail.com
2026-02-07 20:20:53,456 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 20:20:53,456 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Cancelled during run #1
2026-02-07 20:20:55,512 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quelles sont les 10 voitures les plus chères ?"...
2026-02-07 20:20:55,512 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started
2026-02-07 20:20:55,512 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=50
2026-02-07 20:20:55,514 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 20:20:55,514 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 20:20:55,514 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:20:56,932 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 63 events processed
2026-02-07 20:20:56,932 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 20:20:56,933 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:20:56,933 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 20:20:56,973 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 20:20:56,974 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:20:56,975 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:20:58,295 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 46 events processed
2026-02-07 20:20:58,295 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 20:20:58,295 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:20:58,295 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 20:20:58,301 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=data_table
2026-02-07 20:20:58,301 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 20:20:58,301 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded
2026-02-07 20:20:58,302 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:20:58,302 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:21:00,092 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 107 events processed
2026-02-07 20:21:00,092 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=738
2026-02-07 20:21:00,092 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:21:00,092 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:21:00,092 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended
2026-02-07 20:21:00,092 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: visual produced
2026-02-07 20:21:00,092 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 20:21:00,092 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Publishing final: 'Voici les 10 voitures les plus chères, triées par prix :\n\n| Make | Model   | Price         |\n|------...'
2026-02-07 20:21:00,094 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 20:21:00,094 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Stream completed
2026-02-07 20:21:00,094 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 20:21:15,222 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Montre la distribution des soldes des clients"...
2026-02-07 20:21:15,223 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started
2026-02-07 20:21:15,223 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=49
2026-02-07 20:21:15,224 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 20:21:15,224 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 20:21:15,224 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:21:16,908 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 63 events processed
2026-02-07 20:21:16,908 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 20:21:16,908 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:21:16,908 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 20:21:16,932 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 20:21:16,933 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:21:16,933 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:21:18,328 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 40 events processed
2026-02-07 20:21:18,328 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 20:21:18,329 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:21:18,329 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 20:21:18,500 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 20:21:18,500 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 20:21:18,500 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded
2026-02-07 20:21:18,504 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:21:18,505 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:21:19,449 - src.application.data_analysis_agent - ERROR - [AGENT:chabane.abdelkarim@gmail.com] Error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
Traceback (most recent call last):
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 87, in _handle_message
    await self._process_request(parsed)
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/data_analysis_agent.py", line 132, in _process_request
    buffer, _ = await self._stream_processor.process_node(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        node, run.ctx, email, buffer
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 53, in process_node
    buffer = await self._handle_model_request(node, ctx, email, buffer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/src/application/services/stream_processor.py", line 74, in _handle_model_request
    async with node.stream(ctx) as stream:
               ~~~~~~~~~~~^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 213, in request_stream
    response = await self._stream_completions_create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        messages, cast(MistralModelSettings, model_settings or {}), model_request_parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/pydantic_ai/models/mistral.py", line 266, in _stream_completions_create
    response = await self.client.chat.stream_async(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/abdelkarimchabane/Desktop/agent_orbital/venv/lib/python3.13/site-packages/mistralai/chat.py", line 761, in stream_async
    raise models.SDKError("API error occurred", http_res, http_res_text)
mistralai.models.sdkerror.SDKError: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 20:21:19,456 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Publishing error: API error occurred: Status 429. Body: {"object":"error","message":"Rate limit exceeded","type":"rate_limited","param":null,"code":"1300"}
2026-02-07 20:21:19,457 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 20:29:42,853 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Combien de clients ont un service de streaming ...
2026-02-07 20:29:42,857 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started
2026-02-07 20:29:42,858 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=55
2026-02-07 20:29:42,862 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 20:29:42,862 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 20:29:42,864 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:29:44,605 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 76 events processed
2026-02-07 20:29:44,605 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 20:29:44,606 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:29:44,606 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 20:29:44,633 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 20:29:44,635 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:29:44,635 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:29:45,817 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 30 events processed
2026-02-07 20:29:45,817 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 20:29:45,817 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:29:45,817 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 20:29:45,822 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=data_table
2026-02-07 20:29:45,822 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 20:29:45,822 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded
2026-02-07 20:29:45,823 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:29:45,823 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:29:46,559 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 31 events processed
2026-02-07 20:29:46,559 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=121
2026-02-07 20:29:46,559 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:29:46,560 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:29:46,560 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended
2026-02-07 20:29:46,560 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: visual produced
2026-02-07 20:29:46,560 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 20:29:46,560 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Publishing final: 'Il y a 2707 clients qui ont un service de streaming TV. Cela représente une part importante de la ba...'
2026-02-07 20:29:46,561 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 20:29:46,561 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Stream completed
2026-02-07 20:29:46,561 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-07 20:35:39,640 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quel est le prix unitaire moyen par produit ?"...
2026-02-07 20:35:39,642 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started
2026-02-07 20:35:39,642 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=49
2026-02-07 20:35:39,646 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-07 20:35:39,646 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-07 20:35:39,646 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:35:41,760 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 103 events processed
2026-02-07 20:35:41,760 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 20:35:41,760 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:35:41,761 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-07 20:35:41,788 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-07 20:35:41,789 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:35:41,790 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:35:43,812 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 88 events processed
2026-02-07 20:35:43,812 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-07 20:35:43,812 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:35:43,812 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-07 20:35:43,864 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-07 20:35:43,864 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-07 20:35:43,864 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded
2026-02-07 20:35:43,866 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:35:43,866 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-07 20:35:46,454 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 186 events processed
2026-02-07 20:35:46,454 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=355
2026-02-07 20:35:46,454 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-07 20:35:46,454 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-07 20:35:46,454 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended
2026-02-07 20:35:46,454 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: visual produced
2026-02-07 20:35:46,454 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-07 20:35:46,454 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Publishing final: 'Le prix unitaire moyen par produit est affiché dans un graphique à barres. On observe que la souris ...'
2026-02-07 20:35:46,455 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-07 20:35:46,456 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Stream completed
2026-02-07 20:35:46,456 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
2026-02-08 08:17:02,520 - src.application.data_analysis_agent - INFO - [AGENT:test@test.com] New request: Montre moi un exemple de code Python...
2026-02-08 08:17:02,528 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] Request started
2026-02-08 08:17:02,528 - src.application.data_analysis_agent - DEBUG - [AGENT:test@test.com] Starting run #1, history_len=0, prompt_len=36
2026-02-08 08:17:02,534 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] Processing node: UserPromptNode
2026-02-08 08:17:02,534 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] Unknown node type: UserPromptNode
2026-02-08 08:17:02,534 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] Processing node: ModelRequestNode
2026-02-08 08:17:06,105 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] ModelRequest stream finished, 216 events processed
2026-02-08 08:17:06,106 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] ModelRequest done, buffer_len=739
2026-02-08 08:17:06,107 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] Processing node: CallToolsNode
2026-02-08 08:17:06,107 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] ToolCalls done, buffer reset
2026-02-08 08:17:06,107 - src.application.data_analysis_agent - DEBUG - [AGENT:test@test.com] Run #1 ended
2026-02-08 08:17:07,780 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] Judge: needs_viz=False
2026-02-08 08:17:07,780 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] No visualization needed
2026-02-08 08:17:07,780 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] State reset
2026-02-08 08:17:07,780 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] Publishing final: 'Voici un exemple de code Python pour créer un graphique à barres à partir des données de ventes :\n\n`...'
2026-02-08 08:17:07,781 - src.application.services.messaging_service - DEBUG - Stream terminé pour test@test.com
2026-02-08 08:17:07,782 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] Stream completed
2026-02-08 08:17:07,782 - src.application.data_analysis_agent - INFO - [AGENT:test@test.com] Request completed after 1 run(s)
2026-02-08 08:19:00,364 - src.application.data_analysis_agent - INFO - [AGENT:test@test.com] New request: Montre moi un exemple de code Python...
2026-02-08 08:19:00,365 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] Request started
2026-02-08 08:19:00,365 - src.application.data_analysis_agent - DEBUG - [AGENT:test@test.com] Starting run #1, history_len=0, prompt_len=36
2026-02-08 08:19:00,368 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] Processing node: UserPromptNode
2026-02-08 08:19:00,368 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] Unknown node type: UserPromptNode
2026-02-08 08:19:00,368 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] Processing node: ModelRequestNode
2026-02-08 08:19:02,850 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] ModelRequest stream finished, 144 events processed
2026-02-08 08:19:02,850 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] ModelRequest done, buffer_len=688
2026-02-08 08:19:02,850 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] Processing node: CallToolsNode
2026-02-08 08:19:02,850 - src.application.services.stream_processor - DEBUG - [STREAM:test@test.com] ToolCalls done, buffer reset
2026-02-08 08:19:02,850 - src.application.data_analysis_agent - DEBUG - [AGENT:test@test.com] Run #1 ended
2026-02-08 08:19:03,817 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] Judge: needs_viz=False
2026-02-08 08:19:03,817 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] No visualization needed
2026-02-08 08:19:03,817 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] State reset
2026-02-08 08:19:03,818 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] Publishing final: 'Voici un exemple de code Python qui calcule la somme des nombres pairs dans une liste :\n\n```python\n#...'
2026-02-08 08:19:03,819 - src.application.services.messaging_service - DEBUG - Stream terminé pour test@test.com
2026-02-08 08:19:03,819 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:test@test.com] Stream completed
2026-02-08 08:19:03,819 - src.application.data_analysis_agent - INFO - [AGENT:test@test.com] Request completed after 1 run(s)
2026-02-08 08:19:36,139 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] New request: - "Quel est le prix unitaire moyen par produit ?"...
2026-02-08 08:19:36,140 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Request started
2026-02-08 08:19:36,140 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Starting run #1, history_len=0, prompt_len=49
2026-02-08 08:19:36,143 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: UserPromptNode
2026-02-08 08:19:36,143 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Unknown node type: UserPromptNode
2026-02-08 08:19:36,143 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-08 08:19:40,869 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 308 events processed
2026-02-08 08:19:40,869 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-08 08:19:40,875 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-08 08:19:40,875 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: query_data
2026-02-08 08:19:40,989 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=tool_call_result
2026-02-08 08:19:40,991 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-08 08:19:40,991 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-08 08:19:44,198 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 156 events processed
2026-02-08 08:19:44,198 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=0
2026-02-08 08:19:44,198 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-08 08:19:44,198 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall START: visualize
2026-02-08 08:19:44,252 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCall RESULT: type=plotly
2026-02-08 08:19:44,252 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Visual output detected!
2026-02-08 08:19:44,252 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Visual recorded
2026-02-08 08:19:44,253 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-08 08:19:44,253 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: ModelRequestNode
2026-02-08 08:19:46,284 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest stream finished, 106 events processed
2026-02-08 08:19:46,284 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ModelRequest done, buffer_len=379
2026-02-08 08:19:46,284 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] Processing node: CallToolsNode
2026-02-08 08:19:46,284 - src.application.services.stream_processor - DEBUG - [STREAM:chabane.abdelkarim@gmail.com] ToolCalls done, buffer reset
2026-02-08 08:19:46,285 - src.application.data_analysis_agent - DEBUG - [AGENT:chabane.abdelkarim@gmail.com] Run #1 ended
2026-02-08 08:19:46,285 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] SUCCESS: visual produced
2026-02-08 08:19:46,285 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] State reset
2026-02-08 08:19:46,285 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Publishing final: 'Le prix unitaire moyen par produit varie, avec la souris ayant le prix moyen le plus élevé suivi de ...'
2026-02-08 08:19:46,286 - src.application.services.messaging_service - DEBUG - Stream terminé pour chabane.abdelkarim@gmail.com
2026-02-08 08:19:46,286 - src.application.services.visualization_retry_manager - DEBUG - [RETRY:chabane.abdelkarim@gmail.com] Stream completed
2026-02-08 08:19:46,286 - src.application.data_analysis_agent - INFO - [AGENT:chabane.abdelkarim@gmail.com] Request completed after 1 run(s)
